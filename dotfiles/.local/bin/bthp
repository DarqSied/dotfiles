#!/usr/bin/env bash

#Simple script to connect to bt-headphones without gui fluf

mac="2C:FD:B4:7E:56:E1"
status=$(bluetooth | awk '{print $3}')
key=$(bluetoothctl info | head -1 | awk '{print $1}')

if [ "$key" == "Device" ] ; then
    bluetoothctl disconnect $mac
    bluetoothctl power off
    # systemctl --user stop pulseaudio
    if [ "$status" == "on" ] ; then
        rfkill block bluetooth
    fi
    dunstify -u low -r 9995 "Bluetooth" "Bluetooth headphones have been disconnected" 
else
    if [ "$status" == "off" ] ; then
        rfkill unblock bluetooth
    fi
    # systemctl --user start pulseaudio
    bluetoothctl power on
    bluetoothctl connect $mac
    while [ $? -ne 0 ]; do
        bluetoothctl connect $mac
    done
    dunstify -u low -r 9995 "Bluetooth" "Bluetooth headphones are now connected" 
fi

