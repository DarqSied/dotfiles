#!/usr/bin/env bash

# Simple script to move the whole volume function away from a bar(polybar,lemonbar,etc) 
# using pamixer, amixer and dunst

function send_notification() {
    volume=$(pamixer --get-volume)

    if [[ $(pactl list short sinks | grep RUNNING) ]]; then
        output=$(pactl list short sinks | grep RUNNING | awk '{print $2}')
    else
        output=$(pactl list short sinks | tail -n 1 | awk '{print $2}')
    fi

    case "$output" in
        bluez_output.2C_FD_B4_7E_56_E1.1) device='BT Neckband'
        ;;
        alsa_output.pci-0000_00_1f.3.analog-stereo) device='Analog Speakers'
        ;;
        *) device='*New Device*'
        ;;
    esac

    dunstify -u low -r 9993 -h int:value:"$volume" -i "volume-$1" "$device: ${volume}%"
}

case $1 in
    up)
        # Set the volume on (if it was muted)
        pamixer --unmute
        amixer set Master 5%+
        send_notification $1
        ;;
    down)
        pamixer --unmute
        amixer set Master 5%-
        send_notification $1
        ;;
    mute)
        pamixer --toggle-mute
        if [ $(pamixer --get-mute) = true ]; then
            dunstify -i volume-mute -r 9993 -u low "Muted"
        else
            send_notification up
        fi
        ;;
esac

